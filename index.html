<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>Med Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #f8f9fa;
    --surface: #ffffff;
    --surface-hover: #f1f3f5;
    --accent: #2dbb5d; /* Darker green for readability on light */
    --accent-dim: rgba(45, 187, 93, 0.1);
    --text: #000000;
    --text-muted: #555555;
    --danger: #d93025;
    --danger-dim: rgba(217, 48, 37, 0.08);
    --border: #dee2e6;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 40px 20px 80px;
  }

  .header { text-align: center; margin-bottom: 44px; }
  .header h1 { font-family: 'Playfair Display', serif; font-size: 2.2rem; color: var(--text); }
  .header p { color: var(--text-muted); font-size: 0.82rem; margin-top: 6px; text-transform: uppercase; letter-spacing: 0.5px; }

  .container { max-width: 520px; margin: 0 auto; display: flex; flex-direction: column; gap: 16px; }

  /* Timer Card - Now White and Clean */
  .timer-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px 22px 20px;
    transition: transform 0.2s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  }
  .timer-card.running { border-color: var(--accent); border-width: 2px; }
  .timer-card.stopped { border-color: var(--danger); }

  .name-row { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: var(--text); }
  .med-title { font-family: 'Playfair Display', serif; font-size: 1.2rem; font-weight: 700; flex: 1; }

  .delete-btn { background: none; border: none; color: #ccc; font-size: 1.2rem; cursor: pointer; padding: 4px; }
  .delete-btn:hover { color: var(--danger); }

  .time-display { 
    font-family: 'DM Mono', monospace; 
    font-size: 3rem; 
    font-weight: 500; 
    text-align: center; 
    color: var(--text); 
    margin: 15px 0 25px; 
  }
  .running .time-display { color: var(--accent); }

  /* Buttons */
  .controls { display: flex; justify-content: center; gap: 12px; }
  .btn { 
    font-family: 'DM Mono', monospace; 
    font-size: 0.75rem; 
    font-weight: 600; 
    text-transform: uppercase; 
    border: 1.5px solid; 
    border-radius: 8px; 
    padding: 10px 20px; 
    cursor: pointer; 
    background: white;
  }
  .btn-start { border-color: var(--accent); color: var(--accent); }
  .btn-start:hover { background: var(--accent-dim); }
  .btn-stop { border-color: var(--danger); color: var(--danger); }
  .btn-reset { border-color: #777; color: #777; }

  .add-btn { 
    background: var(--surface); 
    border: 1px dashed var(--border); 
    border-radius: 16px; 
    color: var(--text-muted); 
    padding: 20px; 
    font-family: 'DM Mono', monospace;
    cursor: pointer;
    margin-top: 10px;
  }

  /* Badges */
  .badge { font-size: 0.65rem; padding: 3px 8px; border-radius: 12px; margin-left: 5px; font-weight: 600; text-transform: uppercase; vertical-align: middle; }
  .dosage-badge { background: #eee; color: #333; }
  .roa-badge { background: #e7f3ff; color: #007bff; }

  /* Modal Light Theme */
  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); z-index: 100; justify-content: center; align-items: center; }
  .modal-overlay.show { display: flex; }
  .modal { background: white; border-radius: 20px; padding: 30px; width: 90%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
  .modal h2 { margin-bottom: 20px; color: black; }
  .modal-input, .modal-select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; }
</style>
</head>
<body>

<div class="header">
  <h1>Medication Tracker</h1>
  <p>Local Storage Enabled</p>
</div>

<div class="container" id="container">
  <button class="add-btn" onclick="openModal()">+ Add Medication</button>
</div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h2 id="modalTitle">Add Med</h2>
    <div id="modalContent">
        <input class="modal-input" id="modalInput" type="text" placeholder="Name">
        <input class="modal-input" id="modalInputDosage" type="text" placeholder="Dosage (e.g. 200mg)">
        <select class="modal-select" id="modalSelectRoa">
            <option value="Oral">Oral</option>
            <option value="Topical">Topical</option>
            <option value="Injection">Injection</option>
        </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-reset" onclick="closeModal()">Cancel</button>
      <button class="btn btn-start" onclick="saveNewTimer()">Add</button>
    </div>
  </div>
</div>

<script>
  let timers = [];

  function loadData() {
    const saved = localStorage.getItem('med_tracker_v2');
    if (saved) {
      timers = JSON.parse(saved);
      render();
    }
  }

  function saveData() {
    localStorage.setItem('med_tracker_v2', JSON.stringify(timers));
  }

  function openModal() { document.getElementById('modalOverlay').classList.add('show'); }
  function closeModal() { document.getElementById('modalOverlay').classList.remove('show'); }

  function saveNewTimer() {
    const name = document.getElementById('modalInput').value;
    const dosage = document.getElementById('modalInputDosage').value;
    const roa = document.getElementById('modalSelectRoa').value;

    if (!name) return;

    timers.push({
      id: Date.now(),
      name,
      dosage,
      roa,
      startedAt: null,
      elapsed: 0,
      running: false
    });

    saveData();
    render();
    closeModal();
  }

  function getElapsed(timer) {
    if (!timer.running) return timer.elapsed;
    return timer.elapsed + (Date.now() - timer.startedAt);
  }

  function startTimer(id) {
    const t = timers.find(t => t.id === id);
    t.running = true;
    t.startedAt = Date.now();
    saveData();
    render();
  }

  function stopTimer(id) {
    const t = timers.find(t => t.id === id);
    t.elapsed = getElapsed(t);
    t.running = false;
    t.startedAt = null;
    saveData();
    render();
  }

  function resetTimer(id) {
    const t = timers.find(t => t.id === id);
    t.elapsed = 0;
    t.running = false;
    t.startedAt = null;
    saveData();
    render();
  }

  function deleteTimer(id) {
    timers = timers.filter(t => t.id !== id);
    saveData();
    render();
  }

  function formatTime(ms) {
    const s = Math.floor(ms / 1000);
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    const pad = n => String(n).padStart(2, '0');
    return h > 0 ? `${pad(h)}:${pad(m)}:${pad(sec)}` : `${pad(m)}:${pad(sec)}`;
  }

  function render() {
    const container = document.getElementById('container');
    const addBtn = container.querySelector('.add-btn');
    container.querySelectorAll('.timer-card').forEach(el => el.remove());

    timers.forEach(t => {
      const card = document.createElement('div');
      card.className = `timer-card ${t.running ? 'running' : ''}`;
      card.innerHTML = `
        <div class="name-row">
          <span class="med-title">${t.name}</span>
          <span class="badge dosage-badge">${t.dosage}</span>
          <span class="badge roa-badge">${t.roa}</span>
          <button class="delete-btn" onclick="deleteTimer(${t.id})">âœ•</button>
        </div>
        <div class="time-display" id="time-${t.id}">${formatTime(getElapsed(t))}</div>
        <div class="controls">
          ${t.running ? 
            `<button class="btn btn-stop" onclick="stopTimer(${t.id})">Stop</button>` : 
            `<button class="btn btn-start" onclick="startTimer(${t.id})">Start</button>`}
          <button class="btn btn-reset" onclick="resetTimer(${t.id})">Reset</button>
        </div>
      `;
      container.insertBefore(card, addBtn);
    });
  }

  setInterval(() => {
    timers.forEach(t => {
      if (t.running) {
        const el = document.getElementById(`time-${t.id}`);
        if (el) el.textContent = formatTime(getElapsed(t));
      }
    });
  }, 1000);

  loadData();
</script>
</body>
</html>

