<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="apple-touch-icon" href="icon.png">
</head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Med Timer</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface-hover: #222634;
    --accent: #7effa0;
    --accent-dim: rgba(126,255,160,0.15);
    --accent-glow: rgba(126,255,160,0.35);
    --text: #eef0f4;
    --text-muted: #7a7f8e;
    --danger: #ff6b6b;
    --danger-dim: rgba(255,107,107,0.15);
    --running-border: rgba(126,255,160,0.45);
    --stopped-border: rgba(255,107,107,0.3);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 40px 20px 80px;
    /* subtle noise grain */
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  }

  .header {
    text-align: center;
    margin-bottom: 44px;
  }
  .header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 2.2rem;
    letter-spacing: -0.5px;
    color: var(--text);
  }
  .header p {
    color: var(--text-muted);
    font-size: 0.82rem;
    margin-top: 6px;
    letter-spacing: 0.6px;
    text-transform: uppercase;
  }

  .container {
    max-width: 520px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  /* ---- Timer Card ---- */
  .timer-card {
    background: var(--surface);
    border: 1px solid #2a2d3a;
    border-radius: 16px;
    padding: 24px 22px 20px;
    transition: border-color 0.4s ease, box-shadow 0.4s ease;
    animation: slideDown 0.3s cubic-bezier(.34,1.56,.64,1) both;
  }
  .timer-card.running {
    border-color: var(--running-border);
    box-shadow: 0 0 20px var(--accent-dim);
  }
  .timer-card.stopped {
    border-color: var(--stopped-border);
    box-shadow: 0 0 16px var(--danger-dim);
  }

  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-14px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* name row */
  .name-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 18px;
  }
  .name-input {
    flex: 1;
    background: transparent;
    border: none;
    border-bottom: 1px dashed var(--text-muted);
    color: var(--text);
    font-family: 'Playfair Display', serif;
    font-size: 1.05rem;
    font-weight: 600;
    padding: 4px 0;
    outline: none;
    transition: border-color 0.25s;
  }
  .name-input:focus { border-bottom-color: var(--accent); }
  .name-input::placeholder { color: var(--text-muted); }

  .delete-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 4px 6px;
    border-radius: 6px;
    transition: color 0.2s, background 0.2s;
  }
  .delete-btn:hover { color: var(--danger); background: var(--danger-dim); }

  /* time display */
  .time-display {
    font-family: 'DM Mono', monospace;
    font-size: 2.6rem;
    font-weight: 300;
    text-align: center;
    letter-spacing: 2px;
    color: var(--text);
    margin: 8px 0 22px;
    transition: color 0.4s;
  }
  .timer-card.running .time-display { color: var(--accent); }
  .timer-card.stopped  .time-display { color: var(--danger); }

  /* control buttons */
  .controls {
    display: flex;
    justify-content: center;
    gap: 12px;
  }
  .btn {
    font-family: 'DM Mono', monospace;
    font-size: 0.78rem;
    font-weight: 500;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    border: 1px solid;
    border-radius: 8px;
    padding: 9px 24px;
    cursor: pointer;
    transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
    background: transparent;
  }
  .btn:active { transform: scale(0.95); }

  .btn-start {
    border-color: var(--accent);
    color: var(--accent);
  }
  .btn-start:hover {
    background: var(--accent-dim);
    box-shadow: 0 0 12px var(--accent-glow);
  }

  .btn-stop {
    border-color: var(--danger);
    color: var(--danger);
  }
  .btn-stop:hover {
    background: var(--danger-dim);
    box-shadow: 0 0 12px rgba(255,107,107,0.3);
  }

  .btn-reset {
    border-color: var(--text-muted);
    color: var(--text-muted);
  }
  .btn-reset:hover {
    border-color: var(--text);
    color: var(--text);
    background: var(--surface-hover);
  }

  /* ---- Add Timer Button ---- */
  .add-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: transparent;
    border: 1px dashed #3a3d4a;
    border-radius: 16px;
    color: var(--text-muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
    letter-spacing: 0.8px;
    text-transform: uppercase;
    padding: 18px;
    cursor: pointer;
    transition: border-color 0.25s, color 0.25s, background 0.25s;
  }
  .add-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-dim);
  }
  .add-btn .plus {
    font-size: 1.3rem;
    line-height: 1;
  }

  /* empty state */
  .empty-state {
    text-align: center;
    color: var(--text-muted);
    font-size: 0.82rem;
    padding: 10px 0 4px;
    letter-spacing: 0.4px;
  }
</style>
</head>
<body>

<div class="header">
  <h1>Med Timer</h1>
  <p>Track your medication countup timers</p>
</div>

<div class="container" id="container">
  <!-- timers injected here -->
  <button class="add-btn" onclick="addTimer()">
    <span class="plus">+</span> Add Timer
  </button>
</div>

<script>
  // ─── State ────────────────────────────────────
  let timers = [];   // { id, name, startedAt (ms|null), elapsed (ms), running }
  let nextId  = 1;

  // ─── Helpers ──────────────────────────────────
  function pad(n) { return String(n).padStart(2,'0'); }

  function formatTime(ms) {
    const totalSec = Math.floor(ms / 1000);
    const h = Math.floor(totalSec / 3600);
    const m = Math.floor((totalSec % 3600) / 60);
    const s = totalSec % 60;
    return h > 0
      ? `${pad(h)}:${pad(m)}:${pad(s)}`
      : `${pad(m)}:${pad(s)}`;
  }

  function getElapsed(timer) {
    if (!timer.running) return timer.elapsed;
    return timer.elapsed + (Date.now() - timer.startedAt);
  }

  // ─── Core actions ─────────────────────────────
  function addTimer() {
    timers.push({
      id:        nextId++,
      name:      `Medication ${timers.length + 1}`,
      startedAt: null,
      elapsed:   0,
      running:   false
    });
    render();
  }

  function deleteTimer(id) {
    timers = timers.filter(t => t.id !== id);
    render();
  }

  function startTimer(id) {
    const t = timers.find(t => t.id === id);
    if (!t || t.running) return;
    t.running   = true;
    t.startedAt = Date.now();
    render();
  }

  function stopTimer(id) {
    const t = timers.find(t => t.id === id);
    if (!t || !t.running) return;
    t.elapsed  = getElapsed(t);
    t.running  = false;
    t.startedAt = null;
    render();
  }

  function resetTimer(id) {
    const t = timers.find(t => t.id === id);
    if (!t) return;
    t.elapsed   = 0;
    t.running   = false;
    t.startedAt = null;
    render();
  }

  function updateName(id, newName) {
    const t = timers.find(t => t.id === id);
    if (t) t.name = newName;
  }

  // ─── Render ───────────────────────────────────
  function render() {
    const container = document.getElementById('container');
    // keep the add button reference
    const addBtn = container.querySelector('.add-btn');

    // clear all timer cards (not the button)
    container.querySelectorAll('.timer-card').forEach(el => el.remove());

    // insert cards before the add button
    timers.forEach(timer => {
      const card = document.createElement('div');
      card.className = 'timer-card' + (timer.running ? ' running' : (timer.elapsed > 0 ? ' stopped' : ''));
      card.id = 'card-' + timer.id;
      card.innerHTML = `
        <div class="name-row">
          <input class="name-input"
                 type="text"
                 value="${escapeHtml(timer.name)}"
                 placeholder="Timer name…"
                 oninput="updateName(${timer.id}, this.value)" />
          <button class="delete-btn" onclick="deleteTimer(${timer.id})" title="Remove timer">✕</button>
        </div>
        <div class="time-display" id="time-${timer.id}">${formatTime(getElapsed(timer))}</div>
        <div class="controls">
          ${timer.running
            ? `<button class="btn btn-stop"  onclick="stopTimer(${timer.id})">Stop</button>`
            : `<button class="btn btn-start" onclick="startTimer(${timer.id})">Start</button>`
          }
          <button class="btn btn-reset" onclick="resetTimer(${timer.id})">Reset</button>
        </div>
      `;
      container.insertBefore(card, addBtn);
    });

    // empty hint
    const existing = container.querySelector('.empty-state');
    if (existing) existing.remove();
    if (timers.length === 0) {
      const hint = document.createElement('p');
      hint.className = 'empty-state';
      hint.textContent = 'No timers yet — add one below!';
      container.insertBefore(hint, addBtn);
    }
  }

  function escapeHtml(str) {
    const el = document.createElement('div');
    el.textContent = str;
    return el.innerHTML;
  }

  // ─── Tick loop (updates running timer displays every second) ─
  setInterval(() => {
    timers.forEach(timer => {
      if (!timer.running) return;
      const el = document.getElementById('time-' + timer.id);
      if (el) el.textContent = formatTime(getElapsed(timer));
    });
  }, 1000);

  // ─── Init ─────────────────────────────────────
  addTimer();
</script>
</body>
</html>
